---
layout: post
title: ì½”í‹€ë¦° ë°°ìš°ê¸°
image: /assets/img/blog/kotlin.png
accent_image: 
  background: url('/assets/img/me/wave3.jpg') center/cover
  overlay: false
accent_color: '#fff'
theme_color: '#fff'
description: >
  kotlin start!
invert_sidebar: true
categories :
 - devlog	
 - kotlin

---

# [TIL] ì„ ë°œëŒ€ 5ì£¼ì°¨ ì •ë¦¬

* toc
{:toc}
---

## 4ì£¼ì°¨ ê³¼ì œ

**ê³¼ì œ 1**

Bookmark íƒ­ì— ì¶”ê°€í•˜ê¸°

- Switchë¥¼ ë§Œë“¤ì–´ Todo, Bookmark íƒ­ì—ì„œ íŠ¹ì • ì•„ì´í…œì„ **Switchë¥¼ On/Off**ë¥¼ í•  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤.
- Todo íƒ­ì—ì„œ íŠ¹ì • Itemì„ **Switch On** í–ˆì„ ê²½ìš° í•´ë‹¹ Itemì€ **Bookmark íƒ­ì— ì¶”ê°€**í•´ì•¼ í•œë‹¤.
- Bookmark íƒ­ì— ì¶”ê°€ëœ Itemì˜ **Switch Off** í–ˆì„ ê²½ìš° **í•´ë‹¹ Itemì´ ì‚­ì œ** ë˜ì–´ì•¼í•˜ê³  Todo íƒ­ì˜ Itemì€ **Switch Off** ë˜ì–´ì•¼ í•œë‹¤.
- `ê³¼ì œ 1ì€ ë‹¤ìŒì£¼ê¹Œì§€ í•´ë³´ëŠ”ë°, í˜ë“¤ë‹¤ ì´ëŸ¬ë©´ í•œ ì£¼ ë”`

**ê³¼ì œ 2**

`RecyclerView.Adapter`ë¥¼ `ListAdapter`ë¡œ ë³€ê²½í•˜ê¸°

[ListAdapter  | Android Developers](https://developer.android.com/reference/androidx/recyclerview/widget/ListAdapter)

[[Android\] ListAdapter](https://velog.io/@heetaeheo/ListAdapter)

- ListAdapter ì—ëŠ” item ë³„ë¡œ ìœ ë‹ˆí¬í•œ ê°’ì´ í•„ìš”í•¨

  - ex) ìƒí’ˆì˜ id, ìœ ì € idë¥¼ ì§€ì¹­í•  ìˆ˜ ìˆëŠ” ê³ ìœ í•œ ê°’ì´ í•„ìš”í•¨

- ìœ ë‹ˆí¬ ê°’ì€ for loopì˜ i ê°’ì´ì–´ë„ ë¨, ê·¸ë ‡ì§€ë§Œ ë” ì¢‹ì€ ê°’ì´ ìˆìœ¼ë©´ ì¨ë„ë¨

  ```kotlin
  data class TodoModel(
  	val id: Int, // ìœ ë‹ˆí¬ ê°’ 
  	val title: String,
  	val description: String
  )
  ```

**ê³¼ì œ 3 (ì„ íƒì´ì§€ë§Œ í•„ìˆ˜ì´ì§€ë§Œ í–ˆìŒ ì¢‹ê² ìŒ)**

ğŸš¨ê³¼ì œ 2ê¹Œì§€ í–ˆë‹¤ëŠ” ì¡°ê±´ğŸš¨

- TodoFragmentì˜ RecyclerViewë¥¼ ViewModelë¥¼ í†µí•´ ë°ì´í„°ë¥¼ ì„œë¹™í•´ë³´ì.

```kotlin
class TodoViewModel : ViewModel() {
	
	val list = LiveData()
	val _list get() = list

	fun loadItems() {
		_list.value = item
	} 

}

-
class TodoFragment() {

	...

	fun initViewModel() {
		 viewModel.list.observe() { list ->
         listAdapter.submit(list)
     }
  }
	

  ...
}
```

- ìŠ¤í„°ë””
  - MVVM ì•„í‚¤í…ì³, AAC ViewModel, LiveData



## 1) MVVM

- ì•„í‚¤í…ì²˜ì˜ ì‚¬ìš©í•˜ê³ ìˆëŠ” íŒ¨í„´ì¤‘ í•˜ë‚˜

- í˜„ì—…ì—ì„œ ë§ì´ ì‚¬ìš©ë˜ê³  ìš”êµ¬ ë˜ì–´ì§„ë‹¤.

- ì´ê²ƒì„ ì•Œê¸° ìœ„í•´ì„œëŠ” **UI Layer** ê³„ì¸µì„ ì•Œì•„ì•¼í•¨

  - ì´ ì—­í• ì€ , ì–´í”Œë¦¬ì¼€ì´ì…˜ ë°ì´í„¸ë¥´ í‘œì‹œ, ì‚¬ìš©ìì™€ ìƒí˜¸ì‘ìš©
  - ìš°ë¦¬ê°€ í•˜ê³ ìˆëŠ”ê²ƒë“¤ì´ UI Layer 
  - ë°ì´í„° ë ˆì´ì–´ì—ì„œ ê°€ì ¸ì˜¨ ì• í”Œë¦¬ì¼€ì´ì…˜ ê³„ì¸µì„ **ì‹œê°ì ìœ¼ë¡œ** ë‚˜íƒ€ë‚´ëŠ”ê²ƒ
  

* ë·°ëª¨ë¸ì¼ í†µí•œ ë°ì´í„° ì²˜ë¦¬ëŠ” 
  * LiveData
  * Flow 
  * ì¢…ë¥˜ê°€ ìˆìŒ

* **ViewModel**ì€ ë°ì´í„° ë ˆì´ì–´ì— ìˆëŠ” ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ”ê²ƒ
  * UI Layyerr ëŠ” ViewModelì— ë°ì´í„°ë¥¼ ë„˜ê¹€
  * View Modelì€ ì•¡í‹°ë¹„í‹°ì™€ ë…ë¦½ì ì´ë‹¤! 
    * ì•¡í‹°ë¹„í‹°ê°€ ì‹œì‘í•˜ë©´ ê°™ì´ ì‹œì‘í•˜ê³  ëë‚˜ëŠ” ë™ì‹œì— ëë‚¨.



ìš°ë¦¬ëŠ” í™•ì¥ ê°€ëŠ¥í•œ, ìœ ì§€ë³´ìˆ˜ê°€ ê°€ëŠ¥í•œ ì½”ë”©ì„ í•˜ëŠ”ê²ƒì´ ëª©í‘œì´ë‹¤.!



## 2) RecyclerAdapterì—ì„œ ListAdapterë¡œ êµì²´í•˜ëŠ” ë°©ë²•

- **DiffUtil**ì‚¬ìš© í•˜ê¸°ìœ„í•´ ê¸°ì¡´ ë¦¬ì‚¬ì´í´ëŸ¬ ì–´ëŒ‘í„°ë¥¼ ë¦¬ìŠ¤íŠ¸ ì–´ëŒ‘í„°ë¡œ ë³€ê²½í•´ì¤€ë‹¤.

  - DiffUtil ì´ë€? 

  ```
  class TodoListAdapter(
      private val onClickItem: (Int, TodoModel) -> Unit
  ) : ListAdapter<TodoModel, TodoListAdapter.ViewHolder>(
  
      object : DiffUtil.ItemCallback<TodoModel>() {
          override fun areItemsTheSame(
              oldItem: TodoModel,
              newItem: TodoModel
          ): Boolean {
              return oldItem.id == newItem.id
          }
  
          override fun areContentsTheSame(
              oldItem: TodoModel,
              newItem: TodoModel
          ): Boolean {
              return oldItem == newItem
          }
      }
  ) {
  ```

  * ì´ë ‡ê²Œ í•˜ë©´ idì— ì˜¤ë¥˜ê°€ ë‚˜ëŠ”ë° TodoModelì— id ì¶”ê°€í•´ì£¼ê¸°

    ```
    @Parcelize
    data class TodoModel(
        val id: Int,//id ì¶”ê°€
        val title: String?,
        val description: String?
    ) : Parcelable
    ```

    * **ì´ë ‡ê²Œ í•˜ë©´ ë‹¤ë¥¸ í•¨ìˆ˜ë“¤ì„ ë³€ê²½í•´ì¤„ ìˆ˜ ìˆìŒ**
    * **ğŸ’¡ë¦¬ìŠ¤íŠ¸ ì–´ëŒ‘í„° íŠ¹ì§•!** **ListAdapter**ëŠ” ì„œë¸Œë°‹ì„ í• ë•Œ ìƒˆë¡œìš´ array ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•´ì„œ ë„£ì–´ì¤˜ì•¼ í•œë‹¤.

    ```
    fun addItem(todoModel: TodoModel?) {
        val list=currentList.toMutableList()
        list.add(todoModel)
        submitList(list)
    }
    ```

    ```
    fun modifyItem(
            position: Int?,
            todoModel: TodoModel?
        ) {
            if (position == null || todoModel == null) {
                return
            }
            val list=currentList.toMutableList()
            list[position] = todoModel
            submitList(list)
        }
    ```

    ```
    fun removeItem(
        position: Int?
    ) {
        if (position == null) {
            return
        }
        val list=currentList.toMutableList()
        list.removeAt(position)
        submitList(list)
    }
    ```

  


## 3) View Model ë§Œë“¤ê¸°

```
package com.jess.camp.todo.home

import androidx.lifecycle.LiveData
import androidx.lifecycle.MutableLiveData
import androidx.lifecycle.ViewModel
import java.util.concurrent.atomic.AtomicLong

class TodoViewModel : ViewModel() {

    private val _list: MutableLiveData<List<TodoModel>> = MutableLiveData()
   val list: LiveData<List<TodoModel>> get() = _list

    //live= ì•¡í‹°ë¹„í‹°ë‚˜ í”„ë˜ê·¸ë¨¼íŠ¸ì—ì„œ ì½ê¸° ì „ìš©
    //_live= ë·°ëª¨ë¸ ë‚´ë¶€ì—ì„œ ì»¨íŠ¸ë¡¤ ì „ìš©
    val live: LiveData<List<TodoModel>> get() = _list

    // id ë¥¼ ë¶€ì—¬í•  ê°’
    private val idGenerate = AtomicLong(1L)

    init {
        _list.value = arrayListOf<TodoModel>().apply {
            for (i in 0 until 3) {
                add(
                    TodoModel(
                        idGenerate.getAndIncrement(),
                        "title $i",
                        "description $i"
                    )
                )
            }
        }
    }

}
```

* viewmodelì„ ì‚¬ìš©í•˜ë ¤ë©´ id ê°’ì´ í•„ìš”í•˜ë‹ˆ ê·¸ê²ƒì„ ë„£ì–´ì£¼ëŠ” í•¨ìˆ˜ë¥¼**AtomicLong**ë¥¼ ì‚¬ìš©í•´ì¤€ë‹¤.

* ë¦¬ìŠ¤íŠ¸ì—ì„œ todomodelì„ ìƒì„±í• ë•Œ ë§ˆë‹¤ idê°’ì„ ë¶€ì—¬í•´ì£¼ë„ë¡ ì‘ì„±

* TodoModelì— **id : Long,** ë¥¼ ì¶”ê°€í•˜ê³ 

  ```
  @Parcelize
  data class TodoModel(
       val id: Long? = -1,
      val title: String?,
      val description: String?
  ) : Parcelable
  ```

  

* ë°ì´í„°ë¥¼ ë§Œë“¤ë©´ ë¿Œë ¤ì•¼ í•˜ê¸°ë•Œë¬¸ì— **TodoFragment**ì—ì„œ ë·°ëª¨ë¸ì„ ìœ„í•œ init í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ì¤€ë‹¤.

  * ë·°ëª¨ë¸ ìƒì„±ì‹œ ë·°ëª¨ë¸ í”„ë¡œë°”ì´ëœì„ í†µí•´ ë§Œë“¤ì¤˜ì•¼í•¨

  ```
  private val viewModel: TodoViewModel by lazy {
          ViewModelProvider(this)[TodoViewModel::class.java]
      }
  ```

  ```
  override fun onViewCreated(view: View, savedInstanceState: Bundle?) {
          super.onViewCreated(view, savedInstanceState)
          initView()
          initViewModel()//ë·°ëª¨ë¸ì„ ìœ„í•œ í´ë˜ìŠ¤
      }
  		
  		//init ìƒì„±ì
      private fun initViewModel()= with(viewModel) {
          list.observe(viewLifecycleOwner){
              listAdapter.submitList(it)
          }
      }
  ```

  * `viewLifecycleOwner` ë¥¼ í†µí•´ ë¦¬ìŠ¤íŠ¸ì— ìˆëŠ” ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ì•¼í•œë‹¤.
  * ë¼ì´ë¸Œ ë°ì´í„°ì˜ viewLifecycleOwnerë¥¼ ì»ì„ë•Œ í™”ë©´ì´ ìˆì„ë•Œë§Œ ë³´ì—¬ì§€ê³ , ì‚¬ë¼ì¡Œì„ë•ŒëŠ” ë¬´ì‹œë¥¼ í•´ì¤Œ

  * ì˜µì €ë¸Œë¥¼ ë§Œë“¤ì–´ì„œ 
    * í”„ë˜ê·¸ë¨¼íŠ¸ì—ì„œ - ë·°ë¼ì´í”„ì‚¬ì´í´ ì˜¤ë„ˆë¥¼ ì‚¬ìš©
    * ì•¡í‹°ë¹„í‹°ì—ì„œ- thisë¡œ ë¼ì´í”„ì‚¬ì´í´ì˜¤ë„ˆë¥¼ ì‚¬ìš©

  ğŸ’¡ **ë¼ì´ë¸Œë°ì´í„°ì˜ íŠ¹ì§•**: ë¼ì´í”Œì‚¬ì´í´ ì˜¤ë„ˆë¥¼ ë„£ì„ë•Œ í™”ë©´ì´ ì‚¬ë¼ì¡Œì„ë•ŒëŠ” , ë¬´ì‹œí•´ì¤Œ, ì˜µì €ë¹™ì„ ì•ˆí•´ì¤Œ.

  ì¦‰, í™”ë©´ì´ ì£½ì—ˆì„ë•ŒëŠ” ì˜µì €ë¹™ì´ í™œì„±í™”ë˜ì§€ ì•ŠìŒ!



## 3) ì•„ì´í…œì„ ì¶”ê°€ì‹œì¼œì¤„ë•Œ

* **TodoFragment** ì—ì„œ ë³€ê²½í•´ì£¼ê¸°

```
fun setDodoContent(todoModel: TodoModel?) {
        viewModel.addTodoItems(todoModel)
    }
```

* addTodoItemsì„ ì»¤ë§¨ë“œ+ì—”í„° í•˜ì—¬ ë·°ëª¨ë¸ì— í•¨ìˆ˜ë¥¼ ë§Œë“¤ì–´ì£¼ì

  ```
  fun addTodoItem(
          todoModel: TodoModel?
      ) {
          if (todoModel == null) {
              return
          }
  
          val currentList = list.value.orEmpty().toMutableList()
          _list.value = currentList.apply {
              add(
                  todoModel.copy(
                      id = idGenerate.getAndIncrement()
                  )
              )
          }
      }
  ```

  

* **TodoListAdapter** ì—ì„œ **getItemCount()** ì‚­ì œí›„ ì•„ë˜í•¨ìˆ˜ ìˆ˜ì •

  ```
  override fun onBindViewHolder(holder: ViewHolder, position: Int) {
      val item = getItem(position)//ë³€ê²½í•´ì£¼ê¸°
      holder.bind(item)
  }
  ```



ì½”ë“œë¥¼ ì„¤ëª…í•˜ìë©´

1. mainactivity ì—ì„œ ëŸ°ì³ë¥¼ í†µí•´ã…” ë°ì´í„°ê°€ ë“¤ì–´ ì˜¬ê²ƒì´ê³ 

2. todoFragment ì— setDodoContent ë¥¼ ë„˜ê²¨ì„œ
3. ë·° ëª¨ë¸ì„ ìƒì„±í•˜ê³  ë°ì´í„° addTodoItem ë¡œ ë„˜ì–´ì˜¨ ë‹¤ìŒ ë°ì´í„° ì²˜ë¦¬ë¥¼ í•´ì¤Œ!



## 4) ìˆ˜ì •ì„ í•´ì¤„ë•Œ

* í”„ë˜ê·¸ ë¨¼íŠ¸ì— ìˆëŠ” í•¨ìˆ˜ë¥¼ ìˆ˜ì •í•´ì£¼ê¸°

  ```
  private fun modifyTodoItem(
          position: Int?,
          todoModel: TodoModel?
      ) {
          viewModel.modifyItem(
              position,
              todoModel
          )
      }
  ```

  * viewmodelì— modifyItem í•¨ìˆ˜ ìƒì„±í•´ì£¼ê¸°

* ìƒì„±í•œ í•¨ìˆ˜ë¥¼ ì‘ì„±í•´ì£¼ê¸°

  ```
  fun modifyItem(
          position: Int?,
          todoModel: TodoModel?
      ) {
  				//ë§Œì•½ positionì„ ì°¾ì§€ ëª»í–ˆì„ë•Œ
          fun findIndex(item: TodoModel?): Int {
              val currentList = list.value.orEmpty().toMutableList()
              // ê°™ì€ id ë¥¼ ì°¾ìŒ
              val findTodo = currentList.find {
                  it.id == item?.id
              }
  
              // ì°¾ì€ model ê¸°ì¤€ìœ¼ë¡œ index ë¥¼ ì°¾ìŒ
              return currentList.indexOf(findTodo)
          }
  
          if (todoModel == null) {
              return
          }
  
          // position ì´ null ì´ë©´ indexOf ì‹¤ì‹œ
          val findPosition = position ?: findIndex(todoModel)
          if (findPosition < 0) {
              return
          }
  
          val currentList = list.value.orEmpty().toMutableList()
          currentList[findPosition] = todoModel
          _list.value = currentList
      }
  ```





## 5) ì‚­ì œë¥¼ í•´ì¤„ë•Œ

* ì–´ëŒ‘í„°ì— ìˆëŠ” ì‚­ì œ í•¨ìˆ˜ë¥¼ ë³µì‚¬í•´ì™€ ë·° ëª¨ë¸ì— ë„£ì–´ì£¼ê³  ìˆ˜ì •í•˜ê¸°

  * í¬ì§€ì…˜ì„ ë°›ì•„ì˜¤ê³ , ë„ì²˜ë¦¬ì™€ -1ì´ ì•„ë‹Œì§€ í™•ì¸í•œë‹¤ìŒ
  * ë®¤í„°ë¸” ë¦¬ìŠ¤íŠ¸ë¡œ ë°”ê¿”ì¤€ í›„
  * **removeAt** ìœ¼ë¡œ position ì‚­ì œí›„ ë¦¬ìŠ¤íŠ¸ì— ë°˜ì˜

  ```
  fun removeItem(
          position: Int?
      ) {
          if (position == null || position <0) {
              return
          }
          val currentList= list.value.orEmpty().toMutableList()
          currentList?.removeAt(position)
          _list.value=currentList
      }
  ```

* fragment ì— ìˆëŠ” í•¨ìˆ˜ë¥¼ ë·°ëª¨ë¸ë¡œ ë³´ë‚´ì¤€ë‹¤

  ```
  private fun removeItemTodoItem(position: Int?) {
          viewModel.removeItem(position)
      }
  ```

  

* ì–´ëŒ‘í„°ì— ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ì‚­ì œ í•¨ìˆ˜ë¥¼ ì§€ì›Œì¤€ë‹¤!



## 6) ê³¼ì œ 1 ì§„í–‰í•´ë³´ê¸°

1. ë¦¬ì‚¬ì´í´ëŸ¬ë·° ì•„ì´í…œì— ìŠ¤ìœ„ì¹˜ ë„£ì–´ì£¼ê¸° -> idê°’ ë¶€ì—¬
2. íˆ¬ë‘ë¦¬ìŠ¤íŠ¸ì–´ëŒ‘í„°ì—ì„œ í´ë¦­ ë°”ì¸ë”© í•´ì£¼ê¸°

3. í”„ë˜ê·¸ë¨¼íŠ¸ ì—ì„œ ë¦¬ìŠ¤íŠ¸ ì–´ëŒ‘í„° ìˆ˜ì •í•´ì£¼ê¸° ë¶ë§ˆí¬ í´ë¦­ item ë„£ì–´ì£¼ê¸°

```
private val listAdapter by lazy {
        TodoListAdapter(
            onClickItem = { position, item ->
                editTodoLauncher.launch(
                    TodoContentActivity.newIntentForEdit(
                        requireContext(),
                        position,
                        item
                    )
                )
            },
            onBookmarkChecked = { position, item ->
                modifyTodoItem(
                    position = position,
                    item = item
                )
                addItemToBookmarkTab(item)
            }
        )
    }
```

```
/**
 * ì•„ì´í…œì„ ìˆ˜ì •í•©ë‹ˆë‹¤.
 */
fun modifyTodoItem(
    item: TodoModel?,
    position: Int? = null
) {
    viewModel.modifyItem(position, item)
}

/**
 * ì•„ì´í…œì„ ì‚­ì œí•©ë‹ˆë‹¤.
 */
private fun removeItemTodoItem(
    position: Int?
) {
    viewModel.removeItem(position)
}

/**
 * Bookmark Tab ì— ì•„ì´í…œì„ ì¶”ê°€í•©ë‹ˆë‹¤.
 */
private fun addItemToBookmarkTab(
    item: TodoModel
) {
    (activity as? MainActivity)?.addBookmarkItem(item)
}

override fun onDestroyView() {
    _binding = null
    super.onDestroyView()
}
```

* addBookmarkItem ë§Œë“¤ì–´ì£¼ê¸°

* Mainactivityì—ì„œ í•¨ìˆ˜ ì‘ì„±í•´ì£¼ê¸°

  ```
  fun addBookmarkItem(item: TodoModel) {
          val fragment = viewPagerAdapter.getFragment(1) as? BookmarkFragment
          fragment?.addItem(item.toBookmarkModel())
      }
  
      fun modifyTodoItem(item: BookmarkModel) {
          val fragment = viewPagerAdapter.getFragment(0) as? TodoFragment
          val todoItem = item.toTodoModel()
          fragment?.modifyTodoItem(
              item = todoItem
          )
      }
  ```

  
