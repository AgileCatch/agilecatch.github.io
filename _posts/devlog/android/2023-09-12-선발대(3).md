---
layout: post
title: ì½”í‹€ë¦° ë°°ìš°ê¸°
image: /assets/img/blog/kotlin.png
accent_image: 
  background: url('/assets/img/me/wave3.jpg') center/cover
  overlay: false
accent_color: '#fff'
theme_color: '#fff'
description: >
  kotlin start!
invert_sidebar: true
categories :
 - devlog	
 - android

---

# [TIL] ì„ ë°œëŒ€ 4ì£¼ì°¨ ì •ë¦¬

* toc
{:toc}
---

## ì´ë²ˆì£¼ ê³¼ì œ

- TodoEditActivityë¥¼ ë§Œë“¤ì–´ì„œ ì•„ì´í…œì„ **ìˆ˜ì •**í•´ì£¼ì„¸ìš”.
  * ðŸ’¡ **ížŒíŠ¸** MainActivityì—ì„œ TodoAddActivity ì‹¤í–‰ì„ í–ˆëŠ”ë°â€¦? ì´ê±°ë¥¼ ê¼­ MainActivityì—ì„œ í•  í•„ìš”ê°€ ì—†ë‹¤. ì•„ì´í…œì„ í´ë¦­í•œ Fragmentì—ì„œ Activityë¥¼ ì‹¤í–‰í•´ë„ë¨
  * Q. ì•„ì´í…œì„ í´ë¦­í•œ fragmentë¼ê³  í•˜ì‹œë©´ adapterì—ì„œ setonclicklinsterí•´ë„ ë˜ë‚˜ìš”? A. ë„¤, adapterì—ì„œ ë¦¬ìŠ¤ë„ˆë¥¼ ë°›ì•„ì„œ fragmentì—ì„œ TodoEditActivityë¥¼ ì‹¤í–‰ì‹œí‚¤ìž

* TodoAddActivityì™€ TodoEditActivityë¥¼ **í•˜ë‚˜ë¡œ í•©ì³ì„œ ê´€ë¦¬**í•˜ê¸°

  * TodoAddActivity > TodoContentActivityë¡œ ë³€ê²½

  * enum classë¥¼ í™œìš©í•˜ì—¬ TodoContentActivity ì§„ìž… Type ì„¤ì •

  - enum class í™œìš©

    ```
    enum class TodoContentType {
        ADD, EDIT
    }
    companion object {
    		fun newIntentForAdd( // ë“±ë¡
    				context: Context
    		) = Intent(context, TodoContentActivity::class.java).apply {
    				...
    		}
    		
    		fun newIntentForEdit( // ìˆ˜ì •
    				context: Context,
    				...
    		) = Intent(context, TodoContentActivity::class.java).apply {
    				...
    		}
    }
    ```

    * ë„˜ê²¨ ë°›ì€ ë°ì´í„°ë¥¼ EditTextì— ë°”ì¸ë”©

    * ë²„íŠ¼ ì´ë¦„ ë³€ê²½

    - `TodoContentType.ADD`ì¼ ê²½ìš° â€œë“±ë¡â€, `TodoContentType.EDIT` ì¼ ê²½ìš° â€œìˆ˜ì •â€ìœ¼ë¡œ ë³€ê²½

      - â€œì‚­ì œâ€ ë²„íŠ¼ ë§Œë“¤ê¸°

      - â€œì‚­ì œâ€ë¥¼ í´ë¦­í•˜ë©´ Dialogê°€ ë°œìƒí•˜ê³  Dialogì˜ â€œì‚­ì œâ€ë¥¼ ë¶€ë¥´ë©´ TodoFragmentì˜ ì•„ì´í…œ ì‚­ì œ

**ðŸ’¡ížŒíŠ¸**

- ì‚­ì œ ë²„íŠ¼ì„ ëˆŒë €ì„ë•Œ setResult ì‚­ì œì— í•„ìš”í•œ ê°’ì„ ì„¸íŒ…í•´ì„œ ë³´ë‚´ì•¼í•´ìš”.
- serResultì—ì„œ ì„¸íŒ…í•œ ê°’ì„ ì‹¤í–‰ì‹œí‚¨ ëŸ°ì²˜(`registerForActivityResult`)ì—ì„œ ê°’ì„ ë°›ì•„ì„œ ì•„ì´í…œ ì‚­ì œë¥¼ í•˜ë©´ ë¼ìš”.



## 1) enum class ë§Œë“¤ê¸°

- í•œ íŽ˜ì´ì§€ì—ì„œ **ì¶”ê°€,ìˆ˜ì •,ì‚­ì œ**ë¥¼ í•˜ê¸°ìœ„í•´  **enum**í´ëž˜ìŠ¤ ìƒì„±í•´ì£¼ê¸°

  - `name`: enum classë¥¼ ê°€ì ¸ì˜¬ë•Œ ì´ë¦„ìœ¼ë¡œ ê°€ì ¸ì˜¬ìˆ˜ ìžˆìŒ.
  - `ordinal`: enum classë¥¼ ê°€ì ¸ì˜¬ë•Œ ìˆœì„œë¡œ ê°€ì ¸ì˜¬ ìˆ˜ ìžˆìŒ.

  ```
  enum class TodoContentType {
      ADD, EDIT, REMOVE;
  
      //nameì„ ê°€ì§€ê³  enum classë¥¼ ê°€ì ¸ì˜´
      companion object {
          fun from(name: String?): TodoContentType? {
              return TodoContentType.values().find {
                  it.name.uppercase() == name?.uppercase()
              }
          }
      }
  }
  
  fun test(){
      TodoContentType.ADD.name// ì´ë¦„ìœ¼ë¡œ ê°€ì ¸ì˜¤ê¸°
      TodoContentType.ADD.ordinal// 0ë²ˆì§¸ ìžë¦¬ë¡œ ê°€ì ¸ì˜¤ê¸°
  }
  ```



## 2) TodoContentActivity - ì¶”ê°€,ìˆ˜ì •

- ê¸°ì¡´ì— ìžˆë˜ **TodoActivity > TodoContentActivity** ë¡œ ë³€ê²½ í›„ ì¸í…íŠ¸ ì¶”ê°€

- ì¶”ê°€,ìˆ˜ì • ì¸ìŠ¤í„´ìŠ¤ ë§Œë“¤ì–´ì£¼ê¸°

  ```
  companion object {
  
          const val EXTRA_TODO_ENTRY_TYPE = "extra_todo_entry_type"
          const val EXTRA_TODO_POSITION = "extra_todo_position"
          const val EXTRA_TODO_MODEL = "extra_todo_model"
  
          //ì¶”ê°€ì— ëŒ€í•œ ì¸í…íŠ¸
          fun newIntentForAdd(
              context: Context
          ) = Intent(context, TodoContentActivity::class.java).apply {
              //ì´ë„˜ í´ëž˜ìŠ¤ë¥¼ ë„¤ìž„ìœ¼ë¡œ ë°›ì•„ì™€ ë‹¤ì‹œ ë³€í™˜í•´ì¤˜ì•¼ í•˜ëŠ” ê³¼ì •ì´ í•„ìš”í•¨.
              putExtra(EXTRA_TODO_ENTRY_TYPE, TodoContentType.ADD.name)
          }
  
          //ìˆ˜ì •ì— ëŒ€í•œ ì¸í…íŠ¸
          fun newIntentForEdit(
              context: Context,
              position: Int,
              todoModel: TodoModel
          ) = Intent(context, TodoContentActivity::class.java).apply {
              putExtra(EXTRA_TODO_ENTRY_TYPE, TodoContentType.EDIT.name)
              putExtra(EXTRA_TODO_POSITION, position)
              putExtra(EXTRA_TODO_MODEL, todoModel)
          }
      }
         
  ```


* ì—”íŠ¸ë¦¬ë¥¼ ë°›ì•„ì™€ ë³€í™˜í•´ì£¼ëŠ” ê³¼ì •

  ```
  //ì—”íŠ¸ë¦¬ íƒ€ìž… ì¸í…íŠ¸ë¥¼ ë°›ì•„ì™€ ë³€í™˜í•¨
      private val entryType by lazy {
          TodoContentType.from(intent.getStringExtra(EXTRA_TODO_ENTRY_TYPE))
      }
  ```

* ë“±ë¡ ë²„íŠ¼ ëˆŒë €ì„ë•Œ ì²˜ë¦¬í•˜ê¸°

  * ì–´ë–¤í•œ ê°’ì„ ê°€ì§€ê³  ìˆ˜ì • í•  ìˆ˜ ìžˆì„ê²ƒì¸ì§€ ìƒê°í•˜ê¸°
  * **Position, item(datamodel)**

  ```
  submit.setOnClickListener {
              val intent = Intent().apply {
                  putExtra(
                      //ë“±ë¡ì„ ëˆŒë €ì„ë•Œ ì—”íŠ¸ë¦¬íƒ€ìž…ì„ ë³´ë‚´ì¤Œ
                      EXTRA_TODO_ENTRY_TYPE,
                      entryType?.name
                  )
                  putExtra(
                      EXTRA_TODO_POSITION,
                      position
                  )
                  putExtra(
                      EXTRA_TODO_MODEL,
                      TodoModel(
                          todoTitle.text.toString(),
                          todoDescription.text.toString()
                      )
                  )
              }
              setResult(Activity.RESULT_OK, intent)
              finish()
  
          }
  ```

* ì—”íŠ¸ë¦¬ íƒ€ìž…ìœ¼ë¡œ **ë²„íŠ¼ ì´ë¦„ ë³€ê²½**í•˜ê¸°

  ```
  // ë²„íŠ¼ ì´ë¦„ ë³€ê²½
          submit.setText(
              when (entryType) {
                  TodoContentType.EDIT -> R.string.todo_add_edit//ìˆ˜ì •
                  else -> R.string.todo_add_submit//ë“±ë¡
              }
          )
  ```

  

## 3) TodoListAdapter - ìˆ˜ì •

* ì˜¨í´ë¦­ ì„ ì¸í„°íŽ˜ì´ìŠ¤ë¡œ ì„ ì–¸í•˜ì§€ ì•Šê³  ëžŒë‹¤í˜•ì‹ìœ¼ë¡œ ë³€ê²½í•´ ì‚¬ìš©í•˜ê¸°

  ```
  class TodoListAdapter(
      private val onClickItem: (Int, TodoModel) -> Unit
  ) : RecyclerView.Adapter<TodoListAdapter.ViewHolder>() {
  ```

  * ë·°í™€ë”ì— **ì˜¨í´ë¦­ ë¦¬ìŠ¤ë„ˆì™€ ê°™ì´** ì¶”ê°€í•´ì¤˜ì•¼í•¨(item recyclerviewì—  idê°’ ì¶”ê°€í•´ì£¼ê¸°)

    ```
     class ViewHolder(
            private val binding: TodoItemBinding,
            private val onClickItem: (Int, TodoModel) -> Unit
        ) : RecyclerView.ViewHolder(binding.root) {
    
            fun bind(item: TodoModel) = with(binding) {
                title.text = item.title
                description.text = item.description
                
                //ë¦¬ì‚¬ì´í´ëŸ¬ë·° ì•„ì´í…œ í´ë¦­ë¦¬ìŠ¤ë„ˆ ìƒì„±
                container.setOnClickListener {
                    onClickItem(
                        adapterPosition,
                        item
                    )
                }
            }
        }
    ```

  * ì˜¨í¬ë¦¬ì—ì´íŠ¸ ë·° í™€ë”ì— ì˜¨í´ë¦­ ì•„ì´í…œ ì¶”ê°€í•˜ê¸°

    ```
    override fun onCreateViewHolder(parent: ViewGroup, viewType: Int): ViewHolder {
            return ViewHolder(
                TodoItemBinding.inflate(LayoutInflater.from(parent.context), parent, false),
                onClickItem
            )
        }
    ```

    


## 4) TodoFragment - ìˆ˜ì •

* ìˆ˜ì • ê°’ì„ ë°›ì•„ì˜¤ê¸° ìœ„í•œ ëŸ°ì³ ìƒì„±í•˜ê¸°

  ```
  private val editTodoLauncher =
          registerForActivityResult(ActivityResultContracts.StartActivityForResult()) { result ->
              
          }
         
  ```

* ì–´ëŒ‘í„° ì—°ê²°í•´ì£¼ê¸°

  * ë¦¬ìŠ¤íŠ¸ item ì„ í´ë¦­í•¨ê³¼ ë™ì‹œì— ìˆ˜ì •í•  ìˆ˜ ìžˆëŠ” ìƒíƒœë¡œ ë§Œë“¤ì–´ì¤Œ

  ```
  private val listAdapter by lazy {
          TodoListAdapter { position, item ->
              editTodoLauncher.launch(
                  TodoContentActivity.newIntentForEdit(
                      requireContext(),
                      position,
                      item
                  )
              )
          }
      }
  ```

  ```
  private val editTodoLauncher =
          registerForActivityResult(ActivityResultContracts.StartActivityForResult()) { result ->
              if (result.resultCode == Activity.RESULT_OK) {
                  //ì§„ìž…íƒ€ìž…
                  val entryType =
                      result.data?.getStringExtra(TodoContentActivity.EXTRA_TODO_ENTRY_TYPE)
  
                  //ìˆ˜ì •í•  recyclerviewì˜ position
                  val position = result.data?.getIntExtra(TodoContentActivity.EXTRA_TODO_POSITION, -1)
  
                  //ìˆ˜ì •í•œ ì•„ì´í…œ
                  val todoModel = if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.TIRAMISU) {
                      result.data?.getParcelableExtra(
                          TodoContentActivity.EXTRA_TODO_MODEL,
                          TodoModel::class.java
                      )
                  } else {
                      result.data?.getParcelableExtra(
                          TodoContentActivity.EXTRA_TODO_MODEL
                      )
                  }
  
                  // entry type ì— ë”°ë¼ ê¸°ëŠ¥ ë¶„ë¦¬
                  when (TodoContentType.from(entryType)) {
                      TodoContentType.EDIT -> modifyTodoItem(position, todoModel)
                      else -> Unit // nothing
                  }
              }
          }
  ```

  * **TodoFragment** ì— **modifyTodoItem** ë§Œë“¤ì–´ì£¼ê¸°

    ```
    /**
         * ì•„ì´í…œì„ ìˆ˜ì •í•©ë‹ˆë‹¤.
         */
        private fun modifyTodoItem(
            position: Int?,
            todoModel: TodoModel?
        ) {
            listAdapter.modifyItem(
                position,
                todoModel
            )
        }
    ```

    

  * **TodoListAdapter** ë¡œ ì´ë™ í›„ **modifyItem** í•¨ìˆ˜ ë§Œë“¤ì–´ì£¼ê¸°

    ```
    fun modifyItem(
            position: Int?,
            todoModel: TodoModel?
        ) {
            if (position == null || todoModel == null) {
                return
            }
            list[position] = todoModel
            notifyItemChanged(position)
        }
    ```

    

* **TodoContentActivity**ë¡œ ì´ë™ í›„ ì–´ëŒ‘í„°ì—ì„œ ì—°ê²°í•´ì¤€ position , item ê°€ì ¸ì˜¤ê¸°

  ```
  //ì–´ëŒ‘í„°ì—ì„œ ì—°ê²°í•´ì¤€ position , item ê°€ì ¸ì˜¤ê¸°
      private val todoModel by lazy {
          if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.TIRAMISU) {
              intent?.getParcelableExtra(
                  EXTRA_TODO_MODEL,
                  TodoModel::class.java
              )
          } else {
              intent?.getParcelableExtra<TodoModel>(
                  EXTRA_TODO_MODEL
              )
          }
      }
  
      private val position by lazy {
          intent.getIntExtra(EXTRA_TODO_POSITION, -1)
      }
  ```

  

* initData() ë§Œë“¤ì–´ ìˆ˜ì •ì¼ë•Œ ê°’ ê°€ì ¸ì˜¤ê¸°

  ```
  private fun initData() = with(binding) {
          if (entryType == TodoContentType.EDIT) {
              todoTitle.setText(todoModel?.title)
              todoDescription.setText(todoModel?.description)
          }
      }
  ```

  * ë§Œë“  í›„ í•¨ìˆ˜ í˜¸ì¶œí•´ì£¼ê¸°

    ```
    override fun onCreate(savedInstanceState: Bundle?) {
            super.onCreate(savedInstanceState)
            binding = TodoAddActivityBinding.inflate(layoutInflater)
            setContentView(binding.root)
            initView()
            initData()//í˜¸ì¶œ
        }
    ```

    

## 5) TodoContentActivity - ì‚­ì œ

* Init View ì•ˆì— ì‚­ì œë²„íŠ¼ ì„¤ì •í•˜ê¸°

```
 // ì¶”ê°€ ë²„íŠ¼ì´ ì•„ë‹ ê²½ìš° ì‚­ì œ ë²„íŠ¼ ë…¸ì¶œ
        delete.isVisible = entryType != TodoContentType.ADD
```

* **TodoFragment** ì— **removeItemTodoItem** ë§Œë“¤ì–´ì£¼ê¸°

  ```
  /**
       * ì•„ì´í…œì„ ì‚­ì œí•©ë‹ˆë‹¤.
       */
      private fun removeItemTodoItem(position: Int?) {
          listAdapter.removeItem(position)
      }
  
      override fun onDestroyView() {
          _binding = null
          super.onDestroyView()
      }
  ```

  * **editTodoLauncher** ì•ˆì— ì‚­ì œ ì¶”ê°€í•´ì£¼ê¸°

    ```
    // entry type ì— ë”°ë¼ ê¸°ëŠ¥ ë¶„ë¦¬
                    when (TodoContentType.from(entryType)) {
                        TodoContentType.EDIT -> modifyTodoItem(position, todoModel)
                        //ì‚­ì œ
                        TodoContentType.REMOVE -> removeItemTodoItem(position)
                        else -> Unit // nothing
                    }
    ```

    

* **TodoListAdapter** ë¡œ ì´ë™ í›„ **removeItem** í•¨ìˆ˜ ë§Œë“¤ì–´ì£¼ê¸°

  ```
  fun removeItem(
          position: Int?
      ) {
          if (position == null) {
              return
          }
          list.removeAt(position)
          notifyItemRemoved(position)
      }
  ```

  

* ì‚­ì œë²„íŠ¼ ë¦¬ìŠ¤ë„ˆ ë§Œë“¤ê¸°

```
delete.setOnClickListener {
            AlertDialog.Builder(this@TodoContentActivity).apply {
                setMessage(R.string.todo_add_delete_dialog_message)
                setPositiveButton(
                    R.string.todo_add_delete_dialog_positive
                ) { _, _ ->
                    val intent = Intent().apply {
                        putExtra(
                            EXTRA_TODO_ENTRY_TYPE,
                            TodoContentType.REMOVE.name
                        )
                        putExtra(
                            EXTRA_TODO_POSITION,
                            position
                        )
                    }
                    setResult(Activity.RESULT_OK, intent)
                    finish()
                }
                setNegativeButton(
                    R.string.todo_add_delete_dialog_negative
                ) { _, _ ->
                    // nothing
                }
            }.create().show()
        }
```

